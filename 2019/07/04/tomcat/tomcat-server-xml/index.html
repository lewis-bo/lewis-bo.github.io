<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="tomcat,">










<meta name="description" content="详解Tomcat 配置文件server.xm 转自编程迷思-配置文件server.xm                         前言 Tomcat隶属于Apache基金会，是开源的轻量级Web应用服务器，使用非常广泛。server.xml是Tomcat中最重要的配置文件，server.xml的每一个元素都对应了Tomcat中的一个组件；通过对xml文件中元素的配置，可以实现对Tomcat中">
<meta name="keywords" content="tomcat">
<meta property="og:type" content="article">
<meta property="og:title" content="tomcat-server-xml">
<meta property="og:url" content="http://www.note4u.cn/2019/07/04/tomcat/tomcat-server-xml/index.html">
<meta property="og:site_name" content="好记性不如烂笔头">
<meta property="og:description" content="详解Tomcat 配置文件server.xm 转自编程迷思-配置文件server.xm                         前言 Tomcat隶属于Apache基金会，是开源的轻量级Web应用服务器，使用非常广泛。server.xml是Tomcat中最重要的配置文件，server.xml的每一个元素都对应了Tomcat中的一个组件；通过对xml文件中元素的配置，可以实现对Tomcat中">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://common.cnblogs.com/images/copycode.gif">
<meta property="og:image" content="http://common.cnblogs.com/images/copycode.gif">
<meta property="og:image" content="http://common.cnblogs.com/images/copycode.gif">
<meta property="og:image" content="http://common.cnblogs.com/images/copycode.gif">
<meta property="og:image" content="https://images2017.cnblogs.com/blog/1174710/201708/1174710-20170804092103272-2042915115.png">
<meta property="og:image" content="https://images2017.cnblogs.com/blog/1174710/201708/1174710-20170804124947444-1841183869.png">
<meta property="og:image" content="https://images2017.cnblogs.com/blog/1174710/201708/1174710-20170804125116819-1343607672.png">
<meta property="og:image" content="http://common.cnblogs.com/images/copycode.gif">
<meta property="og:image" content="http://common.cnblogs.com/images/copycode.gif">
<meta property="og:image" content="http://common.cnblogs.com/images/copycode.gif">
<meta property="og:image" content="http://common.cnblogs.com/images/copycode.gif">
<meta property="og:image" content="http://common.cnblogs.com/images/copycode.gif">
<meta property="og:image" content="http://common.cnblogs.com/images/copycode.gif">
<meta property="og:image" content="https://images2017.cnblogs.com/blog/1174710/201708/1174710-20170804130208678-1273060779.png">
<meta property="og:image" content="https://img2018.cnblogs.com/blog/1174710/201903/1174710-20190307235328851-496966321.png">
<meta property="og:updated_time" content="2019-07-04T03:44:20.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="tomcat-server-xml">
<meta name="twitter:description" content="详解Tomcat 配置文件server.xm 转自编程迷思-配置文件server.xm                         前言 Tomcat隶属于Apache基金会，是开源的轻量级Web应用服务器，使用非常广泛。server.xml是Tomcat中最重要的配置文件，server.xml的每一个元素都对应了Tomcat中的一个组件；通过对xml文件中元素的配置，可以实现对Tomcat中">
<meta name="twitter:image" content="http://common.cnblogs.com/images/copycode.gif">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://www.note4u.cn/2019/07/04/tomcat/tomcat-server-xml/">





  <title>tomcat-server-xml | 好记性不如烂笔头</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">好记性不如烂笔头</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">In me the tiger sniffs the rose</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.note4u.cn/2019/07/04/tomcat/tomcat-server-xml/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="lewis">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="好记性不如烂笔头">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">tomcat-server-xml</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-07-04T11:14:54+08:00">
                2019-07-04
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/应用服务器/" itemprop="url" rel="index">
                    <span itemprop="name">应用服务器</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/07/04/tomcat/tomcat-server-xml/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2019/07/04/tomcat/tomcat-server-xml/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

		  
  			<span class="post-meta-divider">|</span>
  			浏览 <span id="busuanzi_value_page_pv"></span>
		   

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p><strong><em>详解Tomcat 配置文件server.xm</em></strong></p>
<p>转自<a href="https://www.cnblogs.com/kismetv/p/7228274.html" target="_blank" rel="noopener">编程迷思-配置文件server.xm</a></p>
<p><div id="topics"><br>    <div class="post"><br>        <div class="postBody"><br>            <div id="cnblogs_post_body" class="blogpost-body"><h2>前言</h2></div></div></div></div></p>
<p>Tomcat隶属于Apache基金会，是开源的轻量级Web应用服务器，使用非常广泛。server.xml是Tomcat中最重要的配置文件，<strong>server.xml</strong><strong>的每一个元素都对应了Tomcat</strong><strong>中的一个组件</strong>；通过对xml文件中元素的配置，可以实现对Tomcat中各个组件的控制。因此，学习server.xml文件的配置，对于了解和使用Tomcat至关重要。</p><br><p>本文将通过实例，介绍server.xml中各个组件的配置，并详细说明Tomcat各个核心组件的作用以及各个组件之间的相互关系。</p><br><p>说明：由于server.xml文件中元素与Tomcat中组件的对应关系，后文中为了描述方便，“元素”和“组件”的使用不严格区分。</p><br><p><strong>如果觉得文章对你有帮助，欢迎点赞或转载。文章有疏漏之处，欢迎批评指正。</strong></p><br><h2>目录</h2><br><div class=".catalogue-kismetv"><br><p style="margin-top: 2px; margin-bottom: 2px;"><a href="#title1">一、一个server.xml配置实例</a></p><br><p style="margin-top: 2px; margin-bottom: 2px;"><a href="#title2">二、server.xml文档的元素分类和整体结构</a></p><br><p style="margin-top: 2px; margin-bottom: 2px;">　　<a href="#title2-1">1、整体结构</a></p><br><p style="margin-top: 2px; margin-bottom: 2px;">　　<a href="#title2-2">2、元素分类</a></p><br><p style="margin-top: 2px; margin-bottom: 2px;"><a href="#title3">三、核心组件</a></p><br><p style="margin-top: 2px; margin-bottom: 2px;">　　<a href="#title3-1">1、Server</a></p><br><p style="margin-top: 2px; margin-bottom: 2px;">　　<a href="#title3-2">2、Service</a></p><br><p style="margin-top: 2px; margin-bottom: 2px;">　　<a href="#title3-3">3、Connector</a></p><br><p style="margin-top: 2px; margin-bottom: 2px;">　　<a href="#title3-4">4、Engine</a></p><br><p style="margin-top: 2px; margin-bottom: 2px;">　　<a href="#title3-5">5、Host</a></p><br><p style="margin-top: 2px; margin-bottom: 2px;">　　<a href="#title3-6">6、Context</a></p><br><p style="margin-top: 2px; margin-bottom: 2px;"><a href="#title4">四、核心组件的关联</a></p><br><p style="margin-top: 2px; margin-bottom: 2px;">　　<a href="#title4-1">1、整体关系</a></p><br><p style="margin-top: 2px; margin-bottom: 2px;">　　<a href="#title4-2">2、如何确定请求由谁处理？</a></p><br><p style="margin-top: 2px; margin-bottom: 2px;">　　<a href="#title4-3">3、如何配置多个服务</a></p><br><p style="margin-top: 2px; margin-bottom: 2px;"><a href="#title5">五、其他组件</a></p><br><p style="margin-top: 2px; margin-bottom: 2px;">　　<a href="#title5-1">1、Listener</a></p><br><p style="margin-top: 2px; margin-bottom: 2px;">　　<a href="#title5-2">2、GlobalNamingResources与Realm</a></p><br><p style="margin-top: 2px; margin-bottom: 2px;">　　<a href="#title5-3">3、Valve</a></p><br><p style="margin-top: 2px; margin-bottom: 2px;"><a href="#title6">六、参考文献</a></p><br></div><br><h1><a name="title1"></a>一、一个server.xml配置实例</h1><br><p>server.xml位于$TOMCAT_HOME/conf目录下；下面是一个server.xml实例。后文中将结合该实例讲解server.xml中，各个元素的含义和作用；在阅读后续章节过程中，可以对照该xml文档便于理解。</p><br><div class="cnblogs_code"><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码" target="_blank" rel="noopener"><img src="//common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></span></div><br><pre><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">Server </span><span style="color: #ff0000;">port</span><span style="color: #0000ff;">=”8005”</span><span style="color: #ff0000;"> shutdown</span><span style="color: #0000ff;">=”SHUTDOWN”</span><span style="color: #0000ff;">&gt;</span><br><span style="color: #008080;"> 2</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">Listener </span><span style="color: #ff0000;">className</span><span style="color: #0000ff;">=”org.apache.catalina.startup.VersionLoggerListener”</span> <span style="color: #0000ff;">/&gt;</span><br><span style="color: #008080;"> 3</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">Listener </span><span style="color: #ff0000;">className</span><span style="color: #0000ff;">=”org.apache.catalina.core.AprLifecycleListener”</span><span style="color: #ff0000;"> SSLEngine</span><span style="color: #0000ff;">=”on”</span> <span style="color: #0000ff;">/&gt;</span><br><span style="color: #008080;"> 4</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">Listener </span><span style="color: #ff0000;">className</span><span style="color: #0000ff;">=”org.apache.catalina.core.JasperListener”</span> <span style="color: #0000ff;">/&gt;</span><br><span style="color: #008080;"> 5</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">Listener </span><span style="color: #ff0000;">className</span><span style="color: #0000ff;">=”org.apache.catalina.core.JreMemoryLeakPreventionListener”</span> <span style="color: #0000ff;">/&gt;</span><br><span style="color: #008080;"> 6</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">Listener </span><span style="color: #ff0000;">className</span><span style="color: #0000ff;">=”org.apache.catalina.mbeans.GlobalResourcesLifecycleListener”</span> <span style="color: #0000ff;">/&gt;</span><br><span style="color: #008080;"> 7</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">Listener </span><span style="color: #ff0000;">className</span><span style="color: #0000ff;">=”org.apache.catalina.core.ThreadLocalLeakPreventionListener”</span> <span style="color: #0000ff;">/&gt;</span><br><span style="color: #008080;"> 8</span><br><span style="color: #008080;"> 9</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">GlobalNamingResources</span><span style="color: #0000ff;">&gt;</span><br><span style="color: #008080;">10</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">Resource </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">=”UserDatabase”</span><span style="color: #ff0000;"> auth</span><span style="color: #0000ff;">=”Container”</span><br><span style="color: #008080;">11</span> <span style="color: #ff0000;">              type</span><span style="color: #0000ff;">=”org.apache.catalina.UserDatabase”</span><br><span style="color: #008080;">12</span> <span style="color: #ff0000;">              description</span><span style="color: #0000ff;">=”User database that can be updated and saved”</span><br><span style="color: #008080;">13</span> <span style="color: #ff0000;">              factory</span><span style="color: #0000ff;">=”org.apache.catalina.users.MemoryUserDatabaseFactory”</span><br><span style="color: #008080;">14</span> <span style="color: #ff0000;">              pathname</span><span style="color: #0000ff;">=”conf/tomcat-users.xml”</span> <span style="color: #0000ff;">/&gt;</span><br><span style="color: #008080;">15</span>   <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">GlobalNamingResources</span><span style="color: #0000ff;">&gt;</span><br><span style="color: #008080;">16</span><br><span style="color: #008080;">17</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">Service </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">=”Catalina”</span><span style="color: #0000ff;">&gt;</span><br><span style="color: #008080;">18</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">Connector </span><span style="color: #ff0000;">port</span><span style="color: #0000ff;">=”8080”</span><span style="color: #ff0000;"> protocol</span><span style="color: #0000ff;">=”HTTP/1.1”</span><br><span style="color: #008080;">19</span> <span style="color: #ff0000;">               connectionTimeout</span><span style="color: #0000ff;">=”20000”</span><br><span style="color: #008080;">20</span> <span style="color: #ff0000;">               redirectPort</span><span style="color: #0000ff;">=”8443”</span> <span style="color: #0000ff;">/&gt;</span><br><span style="color: #008080;">21</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">Connector </span><span style="color: #ff0000;">port</span><span style="color: #0000ff;">=”8009”</span><span style="color: #ff0000;"> protocol</span><span style="color: #0000ff;">=”AJP/1.3”</span><span style="color: #ff0000;"> redirectPort</span><span style="color: #0000ff;">=”8443”</span> <span style="color: #0000ff;">/&gt;</span><br><span style="color: #008080;">22</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">Engine </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">=”Catalina”</span><span style="color: #ff0000;"> defaultHost</span><span style="color: #0000ff;">=”localhost”</span><span style="color: #0000ff;">&gt;</span><br><span style="color: #008080;">23</span>       <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">Realm </span><span style="color: #ff0000;">className</span><span style="color: #0000ff;">=”org.apache.catalina.realm.LockOutRealm”</span><span style="color: #0000ff;">&gt;</span><br><span style="color: #008080;">24</span>         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">Realm </span><span style="color: #ff0000;">className</span><span style="color: #0000ff;">=”org.apache.catalina.realm.UserDatabaseRealm”</span><br><span style="color: #008080;">25</span> <span style="color: #ff0000;">               resourceName</span><span style="color: #0000ff;">=”UserDatabase”</span><span style="color: #0000ff;">/&gt;</span><br><span style="color: #008080;">26</span>       <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">Realm</span><span style="color: #0000ff;">&gt;</span><br><span style="color: #008080;">27</span><br><span style="color: #008080;">28</span>       <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">Host </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">=”localhost”</span><span style="color: #ff0000;">  appBase</span><span style="color: #0000ff;">=”webapps”</span><br><span style="color: #008080;">29</span> <span style="color: #ff0000;">            unpackWARs</span><span style="color: #0000ff;">=”true”</span><span style="color: #ff0000;"> autoDeploy</span><span style="color: #0000ff;">=”true”</span><span style="color: #0000ff;">&gt;</span><br><span style="color: #008080;">30</span>         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">Valve </span><span style="color: #ff0000;">className</span><span style="color: #0000ff;">=”org.apache.catalina.valves.AccessLogValve”</span><span style="color: #ff0000;"> directory</span><span style="color: #0000ff;">=”logs”</span><br><span style="color: #008080;">31</span> <span style="color: #ff0000;">               prefix</span><span style="color: #0000ff;">=”localhost_access_log.”</span><span style="color: #ff0000;"> suffix</span><span style="color: #0000ff;">=”.txt”</span><br><span style="color: #008080;">32</span> <span style="color: #ff0000;">               pattern</span><span style="color: #0000ff;">=”%h %l %u %t &amp;quot;%r&amp;quot; %s %b”</span> <span style="color: #0000ff;">/&gt;</span><br><span style="color: #008080;">33</span>       <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">Host</span><span style="color: #0000ff;">&gt;</span><br><span style="color: #008080;">34</span>     <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">Engine</span><span style="color: #0000ff;">&gt;</span><br><span style="color: #008080;">35</span>   <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">Service</span><span style="color: #0000ff;">&gt;</span><br><span style="color: #008080;">36</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">Server</span><span style="color: #0000ff;">&gt;</span></pre><br><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码" target="_blank" rel="noopener"><img src="//common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></span></div></div><br><h1><a name="title2"></a>二、server.xml文档的元素分类和整体结构</h1><br><h2><a name="title2-1"></a>1、整体结构</h2><br><p>server.xml的整体结构如下：</p><br><div class="cnblogs_code"><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码" target="_blank" rel="noopener"><img src="//common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></span></div><br><pre><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">Server</span><span style="color: #0000ff;">&gt;</span><br><span style="color: #008080;"> 2</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">Service</span><span style="color: #0000ff;">&gt;</span><br><span style="color: #008080;"> 3</span>         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">Connector </span><span style="color: #0000ff;">/&gt;</span><br><span style="color: #008080;"> 4</span>         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">Connector </span><span style="color: #0000ff;">/&gt;</span><br><span style="color: #008080;"> 5</span>         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">Engine</span><span style="color: #0000ff;">&gt;</span><br><span style="color: #008080;"> 6</span>             <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">Host</span><span style="color: #0000ff;">&gt;</span><br><span style="color: #008080;"> 7</span>                 <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">Context </span><span style="color: #0000ff;">/&gt;&lt;!– </span><span style="color: #000000;">现在常常使用自动部署，不推荐配置Context元素，Context小节有详细说明 –&gt;<br></span><span style="color: #008080;"> 8</span>             <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">Host</span><span style="color: #0000ff;">&gt;</span><br><span style="color: #008080;"> 9</span>         <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">Engine</span><span style="color: #0000ff;">&gt;</span><br><span style="color: #008080;">10</span>     <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">Service</span><span style="color: #0000ff;">&gt;</span><br><span style="color: #008080;">11</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">Server</span><span style="color: #0000ff;">&gt;</span></pre><br><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码" target="_blank" rel="noopener"><img src="//common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></span></div></div><br><p><span style="line-height: 1.5;">该结构中只给出了Tomcat的核心组件，除了核心组件外，Tomcat还有一些其他组件，下面介绍一下组件的分类。</span></p><br><h2><a name="title2-2"></a>2、元素分类</h2><br><p>server.xml文件中的元素可以分为以下4类：</p><br><p>（1）顶层元素：&lt;Server&gt;和&lt;Service&gt;</p><br><p>&lt;Server&gt;元素是整个配置文件的根元素，&lt;Service&gt;元素则代表一个Engine元素以及一组与之相连的Connector元素。</p><br><p>（2）连接器：&lt;Connector&gt;</p><br><p>&lt;Connector&gt;代表了外部客户端发送请求到特定Service的接口；同时也是外部客户端从特定Service接收响应的接口。</p><br><p>（3）容器：&lt;Engine&gt;&lt;Host&gt;&lt;Context&gt;</p><br><p>容器的功能是处理Connector接收进来的请求，并产生相应的响应。Engine、Host和Context都是容器，但它们不是平行的关系，而是父子关系：Engine包含Host，Host包含Context。一个Engine组件可以处理Service中的所有请求，一个Host组件可以处理发向一个特定虚拟主机的所有请求，一个Context组件可以处理一个特定Web应用的所有请求。</p><br><p>（4）内嵌组件：可以内嵌到容器中的组件。实际上，<strong>Server</strong><strong>、Service</strong><strong>、Connector</strong><strong>、Engine</strong><strong>、Host</strong><strong>和Context</strong><strong>是最重要的最核心的Tomcat</strong><strong>组件</strong>，其他组件都可以归为内嵌组件。</p><br><p>下面将详细介绍Tomcat中各个核心组件的作用，以及相互之间的关系。</p><br><h1><a name="title3"></a>三、核心组件</h1><br><p>本部分将分别介绍各个核心组件的作用、特点以及配置方式等。</p><br><h2><a name="title3-1"></a>1、Server</h2><br><p>Server元素在最顶层，代表整个Tomcat容器，因此它必须是server.xml中唯一一个最外层的元素。<strong>一个</strong><strong>Server</strong><strong>元素中可以有一个或多个Service</strong><strong>元素。</strong></p><br><p>在第一部分的例子中，在最外层有一个&lt;Server&gt;元素，shutdown属性表示关闭Server的指令；port属性表示Server接收shutdown指令的端口号，设为-1可以禁掉该端口。</p><br><p>Server的主要任务，就是提供一个接口让客户端能够访问到这个Service集合，同时维护它所包含的所有的Service的声明周期，包括如何初始化、如何结束服务、如何找到客户端要访问的Service。</p><br><h2><a name="title3-2"></a>2、Service</h2><br><p>Service的作用，是在Connector和Engine外面包了一层，把它们组装在一起，对外提供服务。<strong>一个</strong><strong>Service</strong><strong>可以包含多个Connector</strong><strong>，但是只能包含一个Engine</strong><strong>；</strong>其中Connector的作用是从客户端接收请求，Engine的作用是处理接收进来的请求。</p><br><p>在第一部分的例子中，Server中包含一个名称为“Catalina”的Service。实际上，Tomcat可以提供多个Service，不同的Service监听不同的端口，后文会有介绍。</p><br><h2><a name="title3-3"></a>3、Connector</h2><br><p>Connector的主要功能，是接收连接请求，创建Request和Response对象用于和请求端交换数据；然后分配线程让Engine来处理这个请求，并把产生的Request和Response对象传给Engine。</p><br><p>通过配置Connector，可以控制请求Service的协议及端口号。在第一部分的例子中，Service包含两个Connector：</p><br><div class="cnblogs_code"><br><pre><span style="color: #008080;">1</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">Connector </span><span style="color: #ff0000;">port</span><span style="color: #0000ff;">=”8080”</span><span style="color: #ff0000;"> protocol</span><span style="color: #0000ff;">=”HTTP/1.1”</span><span style="color: #ff0000;"> connectionTimeout</span><span style="color: #0000ff;">=”20000”</span><span style="color: #ff0000;"> redirectPort</span><span style="color: #0000ff;">=”8443”</span> <span style="color: #0000ff;">/&gt;</span><br><span style="color: #008080;">2</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">Connector </span><span style="color: #ff0000;">port</span><span style="color: #0000ff;">=”8009”</span><span style="color: #ff0000;"> protocol</span><span style="color: #0000ff;">=”AJP/1.3”</span><span style="color: #ff0000;"> redirectPort</span><span style="color: #0000ff;">=”8443”</span> <span style="color: #0000ff;">/&gt;</span></pre><br></div><br><p><span style="line-height: 1.5;">（1）通过配置第1个Connector，客户端可以通过8080端口号使用http协议访问Tomcat。其中，protocol属性规定了请求的协议，port规定了请求的端口号，redirectPort表示当强制要求https而请求是http时，重定向至端口号为8443的Connector，connectionTimeout表示连接的超时时间。</span></p><br><p>在这个例子中，Tomcat监听HTTP请求，使用的是8080端口，而不是正式的80端口；实际上，在正式的生产环境中，Tomcat也常常监听8080端口，而不是80端口。这是因为在生产环境中，很少将Tomcat直接对外开放接收请求，而是在Tomcat和客户端之间加一层代理服务器(如nginx)，用于请求的转发、负载均衡、处理静态文件等；通过代理服务器访问Tomcat时，是在局域网中，因此一般仍使用8080端口。</p><br><p>（2）通过配置第2个Connector，客户端可以通过8009端口号使用AJP协议访问Tomcat。AJP协议负责和其他的HTTP服务器(如Apache)建立连接；在把Tomcat与其他HTTP服务器集成时，就需要用到这个连接器。之所以使用Tomcat和其他服务器集成，是因为Tomcat可以用作Servlet/JSP容器，但是对静态资源的处理速度较慢，不如Apache和IIS等HTTP服务器；因此常常将Tomcat与Apache等集成，前者作Servlet容器，后者处理静态资源，而AJP协议便负责Tomcat和Apache的连接。Tomcat与Apache等集成的原理如下图(<a href="http://blog.163.com/cmdbat@126/blog/static/170292123201311301419411/" target="_blank">图片来源</a>)：</p><br><p><img src="https://images2017.cnblogs.com/blog/1174710/201708/1174710-20170804092103272-2042915115.png" alt></p><br><p>关于Connector的更多内容，可以参考我的另一篇文章：<a href="http://www.cnblogs.com/kismetv/p/7806063.html" target="_blank">详解tomcat的连接数与线程池</a></p><br><h2><a name="title3-4"></a>4、Engine</h2><br><p><strong>Engine</strong><strong>组件在Service</strong><strong>组件中有且只有一个；Engine</strong><strong>是Service</strong><strong>组件中的请求处理组件。</strong>Engine组件从一个或多个Connector中接收请求并处理，并将完成的响应返回给Connector，最终传递给客户端。</p><br><p>前面已经提到过，Engine、Host和Context都是容器，但它们不是平行的关系，而是父子关系：Engine包含Host，Host包含Context。</p><br><p>在第一部分的例子中，Engine的配置语句如下：</p><br><div class="cnblogs_code"><br><pre><span style="color: #008080;">1</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">Engine </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">=”Catalina”</span><span style="color: #ff0000;"> defaultHost</span><span style="color: #0000ff;">=”localhost”</span><span style="color: #0000ff;">&gt;</span></pre><br></div><br><p class="a">其中，name属性用于日志和错误信息，在整个Server中应该唯一。defaultHost属性指定了默认的host名称，当发往本机的请求指定的host名称不存在时，一律使用defaultHost指定的host进行处理；因此，defaultHost的值，必须与Engine中的一个Host组件的name属性值匹配。</p><br><h2><a name="title3-5"></a>5、Host</h2><br><h3><a name="title3-5-1"></a>（1）Engine与Host</h3><br><p>Host是Engine的子容器。Engine组件中可以内嵌1个或多个Host组件，<strong>每个</strong><strong>Host</strong><strong>组件代表Engine</strong><strong>中的一个虚拟主机</strong>。Host组件至少有一个，且其中一个的name必须与Engine组件的defaultHost属性相匹配。</p><br><h3><a name="title3-5-2"></a>（2）Host的作用</h3><br><p>Host虚拟主机的作用，是运行多个Web应用（一个Context代表一个Web应用），并负责安装、展开、启动和结束每个Web应用。</p><br><p>Host组件代表的虚拟主机，对应了服务器中一个网络名实体(如”<a href="http://www.test.com”，或IP地址”116.25.25.25”)；为了使用户可以通过网络名连接Tomcat服务器，这个名字应该在DNS服务器上注册。" target="_blank" rel="noopener">www.test.com”，或IP地址”116.25.25.25”)；为了使用户可以通过网络名连接Tomcat服务器，这个名字应该在DNS服务器上注册。</a></p><br><p>客户端通常使用主机名来标识它们希望连接的服务器；该主机名也会包含在HTTP请求头中。Tomcat从HTTP头中提取出主机名，寻找名称匹配的主机。如果没有匹配，请求将发送至默认主机。因此默认主机不需要是在DNS服务器中注册的网络名，因为任何与所有Host名称不匹配的请求，都会路由至默认主机。</p><br><h3><a name="title3-5-3"></a>（3）Host的配置</h3><br><p>在第一部分的例子中，Host的配置如下：</p><br><div class="cnblogs_code"><br><pre><span style="color: #008080;">1</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">Host </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">=”localhost”</span><span style="color: #ff0000;"> appBase</span><span style="color: #0000ff;">=”webapps”</span><span style="color: #ff0000;"> unpackWARs</span><span style="color: #0000ff;">=”true”</span><span style="color: #ff0000;"> autoDeploy</span><span style="color: #0000ff;">=”true”</span><span style="color: #0000ff;">&gt;</span></pre><br></div><br><p>下面对其中配置的属性进行说明：</p><br><p>name属性指定虚拟主机的主机名，一个Engine中有且仅有一个Host组件的name属性与Engine组件的defaultHost属性相匹配；一般情况下，主机名需要是在DNS服务器中注册的网络名，但是Engine指定的defaultHost不需要，原因在前面已经说明。</p><br><p>unpackWARs指定了是否将代表Web应用的WAR文件解压；如果为true，通过解压后的文件结构运行该Web应用，如果为false，直接使用WAR文件运行Web应用。</p><br><p class="a">Host的autoDeploy和appBase属性，与Host内Web应用的自动部署有关；此外，本例中没有出现的xmlBase和deployOnStartup属性，也与Web应用的自动部署有关；将在下一节(Context)中介绍。</p><br><h2><a name="title3-6"></a>6、Context</h2><br><h3><a name="title3-6-1"></a>（1）Context的作用</h3><br><p><strong>Context</strong><strong>元素代表在特定虚拟主机上运行的一个Web</strong><strong>应用。</strong>在后文中，提到Context、应用或Web应用，它们指代的都是Web应用。每个Web应用基于WAR文件，或WAR文件解压后对应的目录（这里称为应用目录）。</p><br><p>Context是Host的子容器，每个Host中可以定义任意多的Context元素。</p><br><p class="a">在第一部分的例子中，可以看到server.xml配置文件中并没有出现Context元素的配置。这是因为，Tomcat开启了自动部署，Web应用没有在server.xml中配置静态部署，而是由Tomcat通过特定的规则自动部署。下面介绍一下Tomcat自动部署Web应用的机制。</p><br><h3><a name="title3-6-2"></a>（2）Web应用自动部署</h3><br><p><strong>Host</strong><strong>的配置</strong></p><br><p>要开启Web应用的自动部署，需要配置所在的虚拟主机；配置的方式就是前面提到的Host元素的deployOnStartup和autoDeploy属性。如果deployOnStartup和autoDeploy设置为true，则tomcat启动自动部署：当检测到新的Web应用或Web应用的更新时，会触发应用的部署(或重新部署)。二者的主要区别在于，deployOnStartup为true时，Tomcat在启动时检查Web应用，且检测到的所有Web应用视作新应用；autoDeploy为true时，Tomcat在运行时定期检查新的Web应用或Web应用的更新。除此之外，二者的处理相似。</p><br><p>通过配置deployOnStartup和autoDeploy可以开启虚拟主机自动部署Web应用；实际上，自动部署依赖于检查是否有新的或更改过的Web应用，而Host元素的appBase和xmlBase设置了检查Web应用更新的目录。</p><br><p>其中，appBase属性指定Web应用所在的目录，默认值是webapps，这是一个相对路径，代表Tomcat根目录下webapps文件夹。</p><br><p>xmlBase属性指定Web应用的XML配置文件所在的目录，默认值为conf/&lt;engine_name&gt;/&lt;host_name&gt;，例如第一部分的例子中，主机localhost的xmlBase的默认值是$TOMCAT_HOME/conf/Catalina/localhost。</p><br><p><strong>检查Web</strong><strong>应用更新 </strong></p><br><p>一个Web应用可能包括以下文件：XML配置文件，WAR包，以及一个应用目录(该目录包含Web应用的文件结构)；其中XML配置文件位于xmlBase指定的目录，WAR包和应用目录位于appBase指定的目录。</p><br><p>Tomcat按照如下的顺序进行扫描，来检查应用更新：</p><br><p>A、扫描虚拟主机指定的xmlBase下的XML配置文件</p><br><p>B、扫描虚拟主机指定的appBase下的WAR文件</p><br><p>C、扫描虚拟主机指定的appBase下的应用目录</p><br><p><strong>&lt;Context&gt;</strong><strong>元素的配置</strong></p><br><p>Context元素最重要的属性是docBase和path，此外reloadable属性也比较常用。</p><br><p>docBase指定了该Web应用使用的WAR包路径，或应用目录。需要注意的是，<strong>在自动部署场景下</strong><strong>(</strong><strong>配置文件位于xmlBase</strong><strong>中)</strong><strong>，docBase</strong><strong>不在appBase</strong><strong>目录中，才需要指定；如果docBase</strong><strong>指定的WAR</strong><strong>包或应用目录就在docBase</strong><strong>中，则不需要指定</strong>，因为Tomcat会自动扫描appBase中的WAR包和应用目录，指定了反而会造成问题。</p><br><p>path指定了访问该Web应用的上下文路径，当请求到来时，Tomcat根据Web应用的 path属性与URI的匹配程度来选择Web应用处理相应请求。例如，Web应用app1的path属性是”/app1”，Web应用app2的path属性是”/app2”，那么请求/app1/index.html会交由app1来处理；而请求/app2/index.html会交由app2来处理。如果一个Context元素的path属性为””，那么这个Context是虚拟主机的默认Web应用；当请求的uri与所有的path都不匹配时，使用该默认Web应用来处理。</p><br><p>但是，需要注意的是，<strong>在自动部署场景下</strong><strong>(</strong><strong>配置文件位于xmlBase</strong><strong>中)</strong><strong>，不能指定path</strong><strong>属性，path</strong><strong>属性由配置文件的文件名、WAR</strong><strong>文件的文件名或应用目录的名称自动推导出来</strong>。如扫描Web应用时，发现了xmlBase目录下的app1.xml，或appBase目录下的app1.WAR或app1应用目录，则该Web应用的path属性是”app1”。如果名称不是app1而是ROOT，则该Web应用是虚拟主机默认的Web应用，此时path属性推导为””。</p><br><p>reloadable属性指示tomcat是否在运行时监控在WEB-INF/classes和WEB-INF/lib目录下class文件的改动。如果值为true，那么当class文件改动时，会触发Web应用的重新加载。在开发环境下，reloadable设置为true便于调试；但是在生产环境中设置为true会给服务器带来性能压力，因此reloadable参数的默认值为false。</p><br><p>下面来看自动部署时，xmlBase下的XML配置文件app1.xml的例子：</p><br><div class="cnblogs_code"><br><pre><span style="color: #008080;">1</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">Context </span><span style="color: #ff0000;">docBase</span><span style="color: #0000ff;">=”D:\Program Files\app1.war”</span><span style="color: #ff0000;"> reloadable</span><span style="color: #0000ff;">=”true”</span><span style="color: #0000ff;">/&gt;</span></pre><br></div><br><p>在该例子中，docBase位于Host的appBase目录之外；path属性没有指定，而是根据app1.xml自动推导为”app1”；由于是在开发环境下，因此reloadable设置为true，便于开发调试。</p><br><p><strong>自动部署举例</strong></p><br><p>最典型的自动部署，就是当我们安装完Tomcat后，$TOMCAT_HOME/webapps目录下有如下文件夹：</p><br><p><img src="https://images2017.cnblogs.com/blog/1174710/201708/1174710-20170804124947444-1841183869.png" alt></p><br><p class="a">当我们启动Tomcat后，可以使用<a href="http://localhost:8080/来访问Tomcat，其实访问的就是ROOT对应的Web应用；我们也可以通过http://localhost:8080/docs来访问docs应用，同理我们可以访问examples/host-manager/manager这几个Web应用。" target="_blank" rel="noopener">http://localhost:8080/来访问Tomcat，其实访问的就是ROOT对应的Web应用；我们也可以通过http://localhost:8080/docs来访问docs应用，同理我们可以访问examples/host-manager/manager这几个Web应用。</a></p><br><h3><a name="title3-6-3"></a>（3）server.xml中静态部署Web应用</h3><br><p><strong>除了自动部署，我们也可以在server.xml</strong><strong>中通过&lt;context&gt;</strong><strong>元素静态部署Web</strong><strong>应用。</strong>静态部署与自动部署是可以共存的。在实际应用中，并不推荐使用静态部署，因为server.xml 是不可动态重加载的资源，服务器一旦启动了以后，要修改这个文件，就得重启服务器才能重新加载。而自动部署可以在Tomcat运行时通过定期的扫描来实现，不需要重启服务器。</p><br><p>server.xml中使用Context元素配置Web应用，Context元素应该位于Host元素中。举例如下：</p><br><div class="cnblogs_code"><br><pre><span style="color: #008080;">1</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">Context </span><span style="color: #ff0000;">path</span><span style="color: #0000ff;">=”/“</span><span style="color: #ff0000;"> docBase</span><span style="color: #0000ff;">=”D:\Program Files \app1.war”</span><span style="color: #ff0000;"> reloadable</span><span style="color: #0000ff;">=”true”</span><span style="color: #0000ff;">/&gt;</span></pre><br></div><br><p>docBase：静态部署时，docBase可以在appBase目录下，也可以不在；本例中，docBase不在appBase目录下。</p><br><p>path：静态部署时，可以显式指定path属性，但是仍然受到了严格的限制：只有当自动部署完全关闭(deployOnStartup和autoDeploy都为false)或docBase不在appBase中时，才可以设置path属性。在本例中，docBase不在appBase中，因此path属性可以设置。</p><br><p>reloadable属性的用法与自动部署时相同。</p><br><h1><a name="title4"></a>四、核心组件的关联</h1><br><h2><a name="title4-1"></a>1、整体关系</h2><br><p>核心组件之间的整体关系，在上一部分有所介绍，这里总结一下：</p><br><p>Server元素在最顶层，代表整个Tomcat容器；一个Server元素中可以有一个或多个Service元素。</p><br><p>Service在Connector和Engine外面包了一层，把它们组装在一起，对外提供服务。一个Service可以包含多个Connector，但是只能包含一个Engine；Connector接收请求，Engine处理请求。</p><br><p>Engine、Host和Context都是容器，且 Engine包含Host，Host包含Context。每个Host组件代表Engine中的一个虚拟主机；每个Context组件代表在特定Host上运行的一个Web应用。</p><br><h2><a name="title4-2"></a>2、如何确定请求由谁处理？</h2><br><p>当请求被发送到Tomcat所在的主机时，如何确定最终哪个Web应用来处理该请求呢？</p><br><h3>（1）根据协议和端口号选定Service和Engine</h3><br><p>Service中的Connector组件可以接收特定端口的请求，因此，当Tomcat启动时，Service组件就会监听特定的端口。在第一部分的例子中，Catalina这个Service监听了8080端口（基于HTTP协议）和8009端口（基于AJP协议）。当请求进来时，Tomcat便可以根据协议和端口号选定处理请求的Service；Service一旦选定，Engine也就确定。</p><br><p>通过在Server中配置多个Service，可以实现通过不同的端口号来访问同一台机器上部署的不同应用。</p><br><h3>（2）根据域名或IP地址选定Host</h3><br><p>Service确定后，Tomcat在Service中寻找名称与域名/IP地址匹配的Host处理该请求。如果没有找到，则使用Engine中指定的defaultHost来处理该请求。在第一部分的例子中，由于只有一个Host（name属性为localhost），因此该Service/Engine的所有请求都交给该Host处理。</p><br><h3>（3）根据URI选定Context/Web应用</h3><br><p>这一点在Context一节有详细的说明：Tomcat根据应用的 path属性与URI的匹配程度来选择Web应用处理相应请求，这里不再赘述。</p><br><h3>（4）举例</h3><br><p class="a">以请求<a href="http://localhost:8080/app1/index.html为例，首先通过协议和端口号（http和8080）选定Service；然后通过主机名（localhost）选定Host；然后通过uri（/app1/index.html）选定Web应用。" target="_blank" rel="noopener">http://localhost:8080/app1/index.html为例，首先通过协议和端口号（http和8080）选定Service；然后通过主机名（localhost）选定Host；然后通过uri（/app1/index.html）选定Web应用。</a></p><br><h2><a name="title4-3"></a>3、如何配置多个服务</h2><br><p>通过在Server中配置多个Service服务，可以实现通过不同的端口号来访问同一台机器上部署的不同Web应用。</p><br><p>在server.xml中配置多服务的方法非常简单，分为以下几步：</p><br><p>（1）复制&lt;Service&gt;元素，放在当前&lt;Service&gt;后面。</p><br><p>（2）修改端口号：根据需要监听的端口号修改&lt;Connector&gt;元素的port属性；必须确保该端口没有被其他进程占用，否则Tomcat启动时会报错，而无法通过该端口访问Web应用。</p><br><p>以Win7为例，可以用如下方法找出某个端口是否被其他进程占用：netstat -aon|findstr “8081”发现8081端口被PID为2064的进程占用，tasklist |findstr “2064”发现该进程为FrameworkService.exe(这是McAfee杀毒软件的进程)。</p><br><p><img src="https://images2017.cnblogs.com/blog/1174710/201708/1174710-20170804125116819-1343607672.png" alt></p><br><p>（3）修改Service和Engine的name属性</p><br><p>（4）修改Host的appBase属性（如webapps2）</p><br><p>（5）Web应用仍然使用自动部署</p><br><p>（6）将要部署的Web应用(WAR包或应用目录)拷贝到新的appBase下。</p><br><p>以第一部分的server.xml为例，多个Service的配置如下：</p><br><div class="cnblogs_code"><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码" target="_blank" rel="noopener"><img src="//common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></span></div><br><pre><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">&lt;?</span><span style="color: #ff00ff;">xml version=’1.0’ encoding=’utf-8’</span><span style="color: #0000ff;">?&gt;</span><br><span style="color: #008080;"> 2</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">Server </span><span style="color: #ff0000;">port</span><span style="color: #0000ff;">=”8005”</span><span style="color: #ff0000;"> shutdown</span><span style="color: #0000ff;">=”SHUTDOWN”</span><span style="color: #0000ff;">&gt;</span><br><span style="color: #008080;"> 3</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">Listener </span><span style="color: #ff0000;">className</span><span style="color: #0000ff;">=”org.apache.catalina.startup.VersionLoggerListener”</span> <span style="color: #0000ff;">/&gt;</span><br><span style="color: #008080;"> 4</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">Listener </span><span style="color: #ff0000;">className</span><span style="color: #0000ff;">=”org.apache.catalina.core.AprLifecycleListener”</span><span style="color: #ff0000;"> SSLEngine</span><span style="color: #0000ff;">=”on”</span> <span style="color: #0000ff;">/&gt;</span><br><span style="color: #008080;"> 5</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">Listener </span><span style="color: #ff0000;">className</span><span style="color: #0000ff;">=”org.apache.catalina.core.JasperListener”</span> <span style="color: #0000ff;">/&gt;</span><br><span style="color: #008080;"> 6</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">Listener </span><span style="color: #ff0000;">className</span><span style="color: #0000ff;">=”org.apache.catalina.core.JreMemoryLeakPreventionListener”</span> <span style="color: #0000ff;">/&gt;</span><br><span style="color: #008080;"> 7</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">Listener </span><span style="color: #ff0000;">className</span><span style="color: #0000ff;">=”org.apache.catalina.mbeans.GlobalResourcesLifecycleListener”</span> <span style="color: #0000ff;">/&gt;</span><br><span style="color: #008080;"> 8</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">Listener </span><span style="color: #ff0000;">className</span><span style="color: #0000ff;">=”org.apache.catalina.core.ThreadLocalLeakPreventionListener”</span> <span style="color: #0000ff;">/&gt;</span><br><span style="color: #008080;"> 9</span><br><span style="color: #008080;">10</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">GlobalNamingResources</span><span style="color: #0000ff;">&gt;</span><br><span style="color: #008080;">11</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">Resource </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">=”UserDatabase”</span><span style="color: #ff0000;"> auth</span><span style="color: #0000ff;">=”Container”</span><span style="color: #ff0000;"> type</span><span style="color: #0000ff;">=”org.apache.catalina.UserDatabase”</span><span style="color: #ff0000;"> description</span><span style="color: #0000ff;">=”User database that can be updated and saved”</span><span style="color: #ff0000;"> factory</span><span style="color: #0000ff;">=”org.apache.catalina.users.MemoryUserDatabaseFactory”</span><span style="color: #ff0000;"> pathname</span><span style="color: #0000ff;">=”conf/tomcat-users.xml”</span> <span style="color: #0000ff;">/&gt;</span><br><span style="color: #008080;">12</span>   <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">GlobalNamingResources</span><span style="color: #0000ff;">&gt;</span><br><span style="color: #008080;">13</span><br><span style="color: #008080;">14</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">Service </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">=”Catalina”</span><span style="color: #0000ff;">&gt;</span><br><span style="color: #008080;">15</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">Connector </span><span style="color: #ff0000;">port</span><span style="color: #0000ff;">=”8080”</span><span style="color: #ff0000;"> protocol</span><span style="color: #0000ff;">=”HTTP/1.1”</span><span style="color: #ff0000;"> connectionTimeout</span><span style="color: #0000ff;">=”20000”</span><span style="color: #ff0000;"> redirectPort</span><span style="color: #0000ff;">=”8443”</span> <span style="color: #0000ff;">/&gt;</span><br><span style="color: #008080;">16</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">Connector </span><span style="color: #ff0000;">port</span><span style="color: #0000ff;">=”8009”</span><span style="color: #ff0000;"> protocol</span><span style="color: #0000ff;">=”AJP/1.3”</span><span style="color: #ff0000;"> redirectPort</span><span style="color: #0000ff;">=”8443”</span> <span style="color: #0000ff;">/&gt;</span><br><span style="color: #008080;">17</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">Engine </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">=”Catalina”</span><span style="color: #ff0000;"> defaultHost</span><span style="color: #0000ff;">=”localhost”</span><span style="color: #0000ff;">&gt;</span><br><span style="color: #008080;">18</span>       <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">Realm </span><span style="color: #ff0000;">className</span><span style="color: #0000ff;">=”org.apache.catalina.realm.LockOutRealm”</span><span style="color: #0000ff;">&gt;</span><br><span style="color: #008080;">19</span>         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">Realm </span><span style="color: #ff0000;">className</span><span style="color: #0000ff;">=”org.apache.catalina.realm.UserDatabaseRealm”</span><br><span style="color: #008080;">20</span> <span style="color: #ff0000;">               resourceName</span><span style="color: #0000ff;">=”UserDatabase”</span><span style="color: #0000ff;">/&gt;</span><br><span style="color: #008080;">21</span>       <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">Realm</span><span style="color: #0000ff;">&gt;</span><br><span style="color: #008080;">22</span><br><span style="color: #008080;">23</span>       <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">Host </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">=”localhost”</span><span style="color: #ff0000;">  appBase</span><span style="color: #0000ff;">=”/opt/project/webapps”</span><span style="color: #ff0000;"> unpackWARs</span><span style="color: #0000ff;">=”true”</span><span style="color: #ff0000;"> autoDeploy</span><span style="color: #0000ff;">=”true”</span><span style="color: #0000ff;">&gt;</span><br><span style="color: #008080;">24</span>         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">Valve </span><span style="color: #ff0000;">className</span><span style="color: #0000ff;">=”org.apache.catalina.valves.AccessLogValve”</span><span style="color: #ff0000;"> directory</span><span style="color: #0000ff;">=”logs”</span><span style="color: #ff0000;"> prefix</span><span style="color: #0000ff;">=”localhost_access_log.”</span><span style="color: #ff0000;"> suffix</span><span style="color: #0000ff;">=”.txt”</span><span style="color: #ff0000;"> pattern</span><span style="color: #0000ff;">=”%h %l %u %t &amp;quot;%r&amp;quot; %s %b”</span> <span style="color: #0000ff;">/&gt;</span><br><span style="color: #008080;">25</span>       <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">Host</span><span style="color: #0000ff;">&gt;</span><br><span style="color: #008080;">26</span>     <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">Engine</span><span style="color: #0000ff;">&gt;</span><br><span style="color: #008080;">27</span>   <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">Service</span><span style="color: #0000ff;">&gt;</span><br><span style="color: #008080;">28</span><br><span style="color: #008080;">29</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">Service </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">=”Catalina2”</span><span style="color: #0000ff;">&gt;</span><br><span style="color: #008080;">30</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">Connector </span><span style="color: #ff0000;">port</span><span style="color: #0000ff;">=”8084”</span><span style="color: #ff0000;"> protocol</span><span style="color: #0000ff;">=”HTTP/1.1”</span><span style="color: #ff0000;"> connectionTimeout</span><span style="color: #0000ff;">=”20000”</span><span style="color: #ff0000;"> redirectPort</span><span style="color: #0000ff;">=”8443”</span> <span style="color: #0000ff;">/&gt;</span><br><span style="color: #008080;">31</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">Connector </span><span style="color: #ff0000;">port</span><span style="color: #0000ff;">=”8010”</span><span style="color: #ff0000;"> protocol</span><span style="color: #0000ff;">=”AJP/1.3”</span><span style="color: #ff0000;"> redirectPort</span><span style="color: #0000ff;">=”8443”</span> <span style="color: #0000ff;">/&gt;</span><br><span style="color: #008080;">32</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">Engine </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">=”Catalina2”</span><span style="color: #ff0000;"> defaultHost</span><span style="color: #0000ff;">=”localhost”</span><span style="color: #0000ff;">&gt;</span><br><span style="color: #008080;">33</span>       <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">Realm </span><span style="color: #ff0000;">className</span><span style="color: #0000ff;">=”org.apache.catalina.realm.LockOutRealm”</span><span style="color: #0000ff;">&gt;</span><br><span style="color: #008080;">34</span>         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">Realm </span><span style="color: #ff0000;">className</span><span style="color: #0000ff;">=”org.apache.catalina.realm.UserDatabaseRealm”</span><br><span style="color: #008080;">35</span> <span style="color: #ff0000;">               resourceName</span><span style="color: #0000ff;">=”UserDatabase”</span><span style="color: #0000ff;">/&gt;</span><br><span style="color: #008080;">36</span>       <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">Realm</span><span style="color: #0000ff;">&gt;</span><br><span style="color: #008080;">37</span><br><span style="color: #008080;">38</span>       <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">Host </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">=”localhost”</span><span style="color: #ff0000;">  appBase</span><span style="color: #0000ff;">=”/opt/project/webapps2”</span><span style="color: #ff0000;"> unpackWARs</span><span style="color: #0000ff;">=”true”</span><span style="color: #ff0000;"> autoDeploy</span><span style="color: #0000ff;">=”true”</span><span style="color: #0000ff;">&gt;</span><br><span style="color: #008080;">39</span>         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">Valve </span><span style="color: #ff0000;">className</span><span style="color: #0000ff;">=”org.apache.catalina.valves.AccessLogValve”</span><span style="color: #ff0000;"> directory</span><span style="color: #0000ff;">=”logs”</span><span style="color: #ff0000;"> prefix</span><span style="color: #0000ff;">=”localhost_access_log.”</span><span style="color: #ff0000;"> suffix</span><span style="color: #0000ff;">=”.txt”</span><span style="color: #ff0000;"> pattern</span><span style="color: #0000ff;">=”%h %l %u %t &amp;quot;%r&amp;quot; %s %b”</span> <span style="color: #0000ff;">/&gt;</span><br><span style="color: #008080;">40</span>       <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">Host</span><span style="color: #0000ff;">&gt;</span><br><span style="color: #008080;">41</span>     <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">Engine</span><span style="color: #0000ff;">&gt;</span><br><span style="color: #008080;">42</span>   <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">Service</span><span style="color: #0000ff;">&gt;</span><br><span style="color: #008080;">43</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">Server</span><span style="color: #0000ff;">&gt;</span></pre><br><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码" target="_blank" rel="noopener"><img src="//common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></span></div></div><br><p>再将原webapps下的docs目录拷贝到webapps2中，则通过如下两个接口都可以访问docs应用：</p><br><p><a href="http://localhost:8080/docs/" target="_blank" rel="noopener">http://localhost:8080/docs/</a></p><br><p class="a"><a href="http://localhost:8084/docs/" target="_blank" rel="noopener">http://localhost:8084/docs/</a></p><br><h1><a name="title5"></a>五、其他组件</h1><br><p>除核心组件外，server.xml中还可以配置很多其他组件。下面只介绍第一部分例子中出现的组件，如果要了解更多内容，可以查看<a href="http://tomcat.apache.org/tomcat-8.0-doc/config/index.html" target="_blank">Tomcat官方文档</a>。</p><br><h2><a name="title5-1"></a>1、Listener</h2><br><div class="cnblogs_code"><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码" target="_blank" rel="noopener"><img src="//common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></span></div><br><pre><span style="color: #008080;">1</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">Listener </span><span style="color: #ff0000;">className</span><span style="color: #0000ff;">=”org.apache.catalina.startup.VersionLoggerListener”</span> <span style="color: #0000ff;">/&gt;</span><br><span style="color: #008080;">2</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">Listener </span><span style="color: #ff0000;">className</span><span style="color: #0000ff;">=”org.apache.catalina.core.AprLifecycleListener”</span><span style="color: #ff0000;"> SSLEngine</span><span style="color: #0000ff;">=”on”</span> <span style="color: #0000ff;">/&gt;</span><br><span style="color: #008080;">3</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">Listener </span><span style="color: #ff0000;">className</span><span style="color: #0000ff;">=”org.apache.catalina.core.JasperListener”</span> <span style="color: #0000ff;">/&gt;</span><br><span style="color: #008080;">4</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">Listener </span><span style="color: #ff0000;">className</span><span style="color: #0000ff;">=”org.apache.catalina.core.JreMemoryLeakPreventionListener”</span> <span style="color: #0000ff;">/&gt;</span><br><span style="color: #008080;">5</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">Listener </span><span style="color: #ff0000;">className</span><span style="color: #0000ff;">=”org.apache.catalina.mbeans.GlobalResourcesLifecycleListener”</span> <span style="color: #0000ff;">/&gt;</span><br><span style="color: #008080;">6</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">Listener </span><span style="color: #ff0000;">className</span><span style="color: #0000ff;">=”org.apache.catalina.core.ThreadLocalLeakPreventionListener”</span> <span style="color: #0000ff;">/&gt;</span></pre><br><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码" target="_blank" rel="noopener"><img src="//common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></span></div></div><br><p>Listener(即监听器)定义的组件，可以在特定事件发生时执行特定的操作；被监听的事件通常是Tomcat的启动和停止。</p><br><p>监听器可以在Server、Engine、Host或Context中，本例中的监听器都是在Server中。实际上，本例中定义的6个监听器，都只能存在于Server组件中。监听器不允许内嵌其他组件。</p><br><p>监听器需要配置的最重要的属性是className，该属性规定了监听器的具体实现类，该类必须实现了org.apache.catalina.LifecycleListener接口。</p><br><p>下面依次介绍例子中配置的监听器：</p><br><ul><br><li>VersionLoggerListener：当Tomcat启动时，该监听器记录Tomcat、Java和操作系统的信息。该监听器必须是配置的第一个监听器。</li><br><li>AprLifecycleListener：Tomcat启动时，检查APR库，如果存在则加载。APR，即Apache Portable Runtime，是Apache可移植运行库，可以实现高可扩展性、高性能，以及与本地服务器技术更好的集成。</li><br><li>JasperListener：在Web应用启动之前初始化Jasper，Jasper是JSP引擎，把JVM不认识的JSP文件解析成java文件，然后编译成class文件供JVM使用。</li><br><li>JreMemoryLeakPreventionListener：与类加载器导致的内存泄露有关。</li><br><li>GlobalResourcesLifecycleListener：通过该监听器，初始化&lt; GlobalNamingResources&gt;标签中定义的全局JNDI资源；如果没有该监听器，任何全局资源都不能使用。&lt; GlobalNamingResources&gt;将在后文介绍。</li><br><li>ThreadLocalLeakPreventionListener：当Web应用因thread-local导致的内存泄露而要停止时，该监听器会触发线程池中线程的更新。当线程执行完任务被收回线程池时，活跃线程会一个一个的更新。只有当Web应用(即Context元素)的renewThreadsWhenStoppingContext属性设置为true时，该监听器才有效。</li><br></ul><br><h2><a name="title5-2"></a>2、GlobalNamingResources与Realm</h2><br><p>第一部分的例子中，Engine组件下定义了Realm组件：</p><br><div class="cnblogs_code"><br><pre><span style="color: #008080;">1</span>       <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">Realm </span><span style="color: #ff0000;">className</span><span style="color: #0000ff;">=”org.apache.catalina.realm.LockOutRealm”</span><span style="color: #0000ff;">&gt;</span><br><span style="color: #008080;">2</span>         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">Realm </span><span style="color: #ff0000;">className</span><span style="color: #0000ff;">=”org.apache.catalina.realm.UserDatabaseRealm”</span><br><span style="color: #008080;">3</span> <span style="color: #ff0000;">               resourceName</span><span style="color: #0000ff;">=”UserDatabase”</span><span style="color: #0000ff;">/&gt;</span><br><span style="color: #008080;">4</span>       <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">Realm</span><span style="color: #0000ff;">&gt;</span></pre><br></div><br><p>Realm，可以把它理解成“域”；<strong>Realm</strong><strong>提供了一种用户密码与web</strong><strong>应用的映射关系，从而达到角色安全管理的作用。</strong>在本例中，Realm的配置使用name为UserDatabase的资源实现。而该资源在Server元素中使用GlobalNamingResources配置：</p><br><div class="cnblogs_code"><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码" target="_blank" rel="noopener"><img src="//common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></span></div><br><pre><span style="color: #008080;">1</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">GlobalNamingResources</span><span style="color: #0000ff;">&gt;</span><br><span style="color: #008080;">2</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">Resource </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">=”UserDatabase”</span><span style="color: #ff0000;"> auth</span><span style="color: #0000ff;">=”Container”</span><span style="color: #ff0000;"> type</span><span style="color: #0000ff;">=”org.apache.catalina.UserDatabase”</span><span style="color: #ff0000;"> description</span><span style="color: #0000ff;">=”User database that can be updated and saved”</span><span style="color: #ff0000;"> factory</span><span style="color: #0000ff;">=”org.apache.catalina.users.MemoryUserDatabaseFactory”</span><span style="color: #ff0000;"> pathname</span><span style="color: #0000ff;">=”conf/tomcat-users.xml”</span> <span style="color: #0000ff;">/&gt;</span><br><span style="color: #008080;">3</span>   <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">GlobalNamingResources</span><span style="color: #0000ff;">&gt;</span></pre><br><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码" target="_blank" rel="noopener"><img src="//common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></span></div></div><br><p>GlobalNamingResources元素定义了全局资源，通过配置可以看出，该配置是通过读取$TOMCAT_HOME/ conf/tomcat-users.xml实现的。</p><br><p>关于Tomcat域管理的更多内容，可以参考：<a title="Realm域管理" href="http://www.cnblogs.com/xing901022/p/4552843.html" target="_blank">Realm域管理</a></p><br><h2><a name="title5-3"></a>3、Valve</h2><br><p>在第一部分的例子中，Host元素内定义了Valve组件：</p><br><div class="cnblogs_code"><br><pre><span style="color: #008080;">1</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">Valve </span><span style="color: #ff0000;">className</span><span style="color: #0000ff;">=”org.apache.catalina.valves.AccessLogValve”</span><span style="color: #ff0000;"> directory</span><span style="color: #0000ff;">=”logs”</span><span style="color: #ff0000;"> prefix</span><span style="color: #0000ff;">=”localhost_access_log.”</span><span style="color: #ff0000;"> suffix</span><span style="color: #0000ff;">=”.txt”</span><span style="color: #ff0000;"> pattern</span><span style="color: #0000ff;">=”%h %l %u %t &amp;quot;%r&amp;quot; %s %b”</span> <span style="color: #0000ff;">/&gt;</span></pre><br></div><br><p>单词Valve的意思是“阀门”，在Tomcat中代表了请求处理流水线上的一个组件；Valve可以与Tomcat的容器(Engine、Host或Context)关联。</p><br><p>不同的Valve有不同的特性，下面介绍一下本例中出现的AccessLogValve。</p><br><p>AccessLogValve的作用是通过日志记录其所在的容器中处理的所有请求，在本例中，Valve放在Host下，便可以记录该Host处理的所有请求。<strong>AccessLogValve记录的日志就是访问日志，每天的请求会写到一个日志文件里。</strong>AccessLogValve可以与Engine、Host或Context关联；在本例中，只有一个Engine，Engine下只有一个Host，Host下只有一个Context，因此AccessLogValve放在三个容器下的作用其实是类似的。</p><br><p>本例的AccessLogValve属性的配置，使用的是默认的配置；下面介绍AccessLogValve中各个属性的作用：</p><br><p>（1）className：规定了Valve的类型，是最重要的属性；本例中，通过该属性规定了这是一个AccessLogValve。</p><br><p>（2）directory：指定日志存储的位置，本例中，日志存储在$TOMCAT_HOME/logs目录下。</p><br><p>（3）prefix：指定了日志文件的前缀。</p><br><p>（4）suffix：指定了日志文件的后缀。通过directory、prefix和suffix的配置，在$TOMCAT_HOME/logs目录下，可以看到如下所示的日志文件。</p><br><p><img src="https://images2017.cnblogs.com/blog/1174710/201708/1174710-20170804130208678-1273060779.png" alt></p><br><p>（5）pattern：指定记录日志的格式，本例中各项的含义如下：</p><br><ul><br><li>%h：远程主机名或IP地址；如果有nginx等反向代理服务器进行请求分发，该主机名/IP地址代表的是nginx，否则代表的是客户端。后面远程的含义与之类似，不再解释。</li><br><li>%l：远程逻辑用户名，一律是”-”，可以忽略。</li><br><li>%u：授权的远程用户名，如果没有，则是”-”。</li><br><li>%t：访问的时间。</li><br><li>%r：请求的第一行，即请求方法(get/post等)、uri、及协议。</li><br><li>%s：响应状态，200,404等等。</li><br><li>%b：响应的数据量，不包括请求头，如果为0，则是””-。</li><br></ul><br><p>例如，下面是访问日志中的一条记录</p><br><p><img src="https://img2018.cnblogs.com/blog/1174710/201903/1174710-20190307235328851-496966321.png" alt></p><br><p>pattern的配置中，除了上述各项，还有一个非常常用的选项是%D，含义是请求处理的时间(单位是毫秒)，对于统计分析请求的处理速度帮助很大。</p><br><p class="a"><strong>开发人员可以充分利用访问日志，来分析问题、优化应用。</strong>例如，分析访问日志中各个接口被访问的比例，不仅可以为需求和运营人员提供数据支持，还可以使自己的优化有的放矢；分析访问日志中各个请求的响应状态码，可以知道服务器请求的成功率，并找出有问题的请求；分析访问日志中各个请求的响应时间，可以找出慢请求，并根据需要进行响应时间的优化。</p><br><h1 class="a"><a name="title6"></a>六、参考文献</h1><br><p><a href="http://tomcat.apache.org/tomcat-8.0-doc/config/index.html" target="_blank">Tomcat官方文档</a></p><br><p>《How Tomcat Works》</p><br><p>《深入分析Java Web技术内幕》</p><br><p><a href="http://www.cnblogs.com/xing901022/p/4552843.html" target="_blank">Tomcat 6 —— Realm域管理</a></p><br><p><a href="http://blog.163.com/cmdbat@126/blog/static/170292123201311301419411/" target="_blank">Tomcat Port 8009 与AJP13协议</a></p><br><p class="a"><a href="http://www.cnblogs.com/xing901022/p/4592159.html" target="_blank">使用Jasper引擎解析JSP</a></p>





      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/tomcat/" rel="tag"># tomcat</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/06/10/algorithm/leetcode-21-java/" rel="next" title="leetcode-21-java">
                <i class="fa fa-chevron-left"></i> leetcode-21-java
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/07/20/mysql/mysql-insert-batch/" rel="prev" title="PreparedStatement之executeBatch">
                PreparedStatement之executeBatch <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
      <div id="SOHUCS"></div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">lewis</p>
              <p class="site-description motion-element" itemprop="description">JAVA|PYTHON|GIRL</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">27</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">6</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">16</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#undefined"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#undefined"><span class="nav-number">2.</span> <span class="nav-text">目录</span></a></li></ol><li class="nav-item nav-level-1"><a class="nav-link" href="#undefined"><span class="nav-number"></span> <span class="nav-text">一、一个server.xml配置实例</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#undefined"><span class="nav-number"></span> <span class="nav-text">二、server.xml文档的元素分类和整体结构</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#undefined"><span class="nav-number">1.</span> <span class="nav-text">1、整体结构</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#undefined"><span class="nav-number">2.</span> <span class="nav-text">2、元素分类</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#undefined"><span class="nav-number"></span> <span class="nav-text">三、核心组件</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#undefined"><span class="nav-number">1.</span> <span class="nav-text">1、Server</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#undefined"><span class="nav-number">2.</span> <span class="nav-text">2、Service</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#undefined"><span class="nav-number">3.</span> <span class="nav-text">3、Connector</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#undefined"><span class="nav-number">4.</span> <span class="nav-text">4、Engine</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#undefined"><span class="nav-number">5.</span> <span class="nav-text">5、Host</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#undefined"><span class="nav-number">5.1.</span> <span class="nav-text">（1）Engine与Host</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#undefined"><span class="nav-number">5.2.</span> <span class="nav-text">（2）Host的作用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#undefined"><span class="nav-number">5.3.</span> <span class="nav-text">（3）Host的配置</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#undefined"><span class="nav-number">6.</span> <span class="nav-text">6、Context</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#undefined"><span class="nav-number">6.1.</span> <span class="nav-text">（1）Context的作用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#undefined"><span class="nav-number">6.2.</span> <span class="nav-text">（2）Web应用自动部署</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#undefined"><span class="nav-number">6.3.</span> <span class="nav-text">（3）server.xml中静态部署Web应用</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#undefined"><span class="nav-number"></span> <span class="nav-text">四、核心组件的关联</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#undefined"><span class="nav-number">1.</span> <span class="nav-text">1、整体关系</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#undefined"><span class="nav-number">2.</span> <span class="nav-text">2、如何确定请求由谁处理？</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#undefined"><span class="nav-number">2.1.</span> <span class="nav-text">（1）根据协议和端口号选定Service和Engine</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#undefined"><span class="nav-number">2.2.</span> <span class="nav-text">（2）根据域名或IP地址选定Host</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#undefined"><span class="nav-number">2.3.</span> <span class="nav-text">（3）根据URI选定Context/Web应用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#undefined"><span class="nav-number">2.4.</span> <span class="nav-text">（4）举例</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#undefined"><span class="nav-number">3.</span> <span class="nav-text">3、如何配置多个服务</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#undefined"><span class="nav-number"></span> <span class="nav-text">五、其他组件</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#undefined"><span class="nav-number">1.</span> <span class="nav-text">1、Listener</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#undefined"><span class="nav-number">2.</span> <span class="nav-text">2、GlobalNamingResources与Realm</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#undefined"><span class="nav-number">3.</span> <span class="nav-text">3、Valve</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#undefined"><span class="nav-number"></span> <span class="nav-text">六、参考文献</span></a></li></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">lewis</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>


<div>
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<span id="busuanzi_container_site_uv" style="display:none">
    本站访问人数 <span id="busuanzi_value_site_uv"></span>
    <span class="post-meta-divider">|</span>
</span>
<span id="busuanzi_container_site_pv" style="display:none">
    本站总访问量 <span id="busuanzi_value_site_pv"></span>
</span>
</div>



        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  










  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src="//unpkg.com/valine/dist/Valine.min.js"></script>
  
  <script type="text/javascript">
    var GUEST = ['nick','mail','link'];
    var guest = 'nick,mail';
    guest = guest.split(',').filter(item=>{
      return GUEST.indexOf(item)>-1;
    });
    new Valine({
        el: '#comments' ,
        verify: false,
        notify: false,
        appId: '4CPzOntMjHqxx2HisCebnNoz-gzGzoHsz',
        appKey: 'iJTHkFsl7CzPtdEb3m8Tm0LB',
        placeholder: '有问题请指教,共同学习进步',
        avatar:'mm',
        guest_info:guest,
        pageSize:'10' || 10,
    });
  </script>



  





  

  

  

  
  

  

  

  

</body>
</html>
